"use strict";(globalThis.webpackChunkrobolearn=globalThis.webpackChunkrobolearn||[]).push([[5148],{2458:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"module-1-ros/communication/5-2-service-clients","title":"Lesson 5.2: Service Client","description":"Calling a service from the command line is useful for testing, but in a real robot, you\'ll have another node that acts as the client. The client is responsible for sending the request and waiting for the response.","source":"@site/docs/module-1-ros/5-communication/5-2-service-clients.md","sourceDirName":"module-1-ros/5-communication","slug":"/module-1-ros/communication/5-2-service-clients","permalink":"/robolearn/docs/module-1-ros/communication/5-2-service-clients","draft":false,"unlisted":false,"editUrl":"https://github.com/Muhammadsaimraza/robolearn/tree/main/docs/module-1-ros/5-communication/5-2-service-clients.md","tags":[],"version":"current","frontMatter":{},"sidebar":"textbookSidebar","previous":{"title":"Lesson 5.1: Service Server","permalink":"/robolearn/docs/module-1-ros/communication/5-1-service-server"},"next":{"title":"Lesson 5.3: Custom Interfaces","permalink":"/robolearn/docs/module-1-ros/communication/5-3-custom-interface"}}');var r=s(4848),i=s(8453);const l={},o="Lesson 5.2: Service Client",c={},d=[{value:"The Code",id:"the-code",level:2},{value:"Code Breakdown",id:"code-breakdown",level:3},{value:"Registering and Building",id:"registering-and-building",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"lesson-52-service-client",children:"Lesson 5.2: Service Client"})}),"\n",(0,r.jsxs)(n.p,{children:["Calling a service from the command line is useful for testing, but in a real robot, you'll have another node that acts as the ",(0,r.jsx)(n.strong,{children:"client"}),". The client is responsible for sending the request and waiting for the response."]}),"\n",(0,r.jsxs)(n.p,{children:["A key difference from subscribers is that a service call is typically ",(0,r.jsx)(n.strong,{children:"synchronous"}),". The client code will pause and wait until the server sends back the response."]}),"\n",(0,r.jsx)(n.h2,{id:"the-code",children:"The Code"}),"\n",(0,r.jsxs)(n.p,{children:["Let's create a client node to call our ",(0,r.jsx)(n.code,{children:"add_two_ints"})," service. Create a new file: ",(0,r.jsx)(n.code,{children:"my_first_package/add_two_ints_client.py"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# my_first_package/my_first_package/add_two_ints_client.py\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\nclass AddTwoIntsClientNode(Node):\n    \"\"\"\n    A ROS 2 node that calls the add_two_ints service.\n    \"\"\"\n    def __init__(self):\n        super().__init__('add_two_ints_client_node')\n        self.client = self.create_client(AddTwoInts, 'add_two_ints')\n        \n        # Wait for the service to be available\n        while not self.client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        \n        self.req = AddTwoInts.Request()\n\n    def send_request(self, a, b):\n        self.req.a = a\n        self.req.b = b\n        self.future = self.client.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n\ndef main(args=None):\n    rclpy.init(args=args)\n    \n    client_node = AddTwoIntsClientNode()\n    response = client_node.send_request(5, 10)\n    \n    if response:\n        client_node.get_logger().info(\n            f'Result of add_two_ints: for {5} + {10} = {response.sum}')\n    else:\n        client_node.get_logger().error('Service call failed')\n        \n    client_node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h3,{id:"code-breakdown",children:"Code Breakdown"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"AddTwoIntsClientNode"})," Class:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.create_client(AddTwoInts, 'add_two_ints')"}),": We create a client for a service of type ",(0,r.jsx)(n.code,{children:"AddTwoInts"})," on the topic ",(0,r.jsx)(n.code,{children:"'add_two_ints'"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.client.wait_for_service(...)"}),": This is a crucial step. The client will wait here until it can connect to a server. This prevents the client from trying to send a request before the server is ready."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"send_request"})," Method:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.req.a = a; self.req.b = b"}),": We populate the request object."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"self.client.call_async(self.req)"}),": We send the request. This call is ",(0,r.jsx)(n.strong,{children:"asynchronous"}),'\u2014it returns immediately with a "Future" object that represents a task that will be completed in the future.']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"rclpy.spin_until_future_complete(self, self.future)"}),": This is the synchronous part. We spin the node, blocking our program, until the Future object is populated with a result from the server."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"return self.future.result()"}),": We return the result contained within the Future."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"main"})," Function:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"We create the client node."}),"\n",(0,r.jsxs)(n.li,{children:["We call ",(0,r.jsx)(n.code,{children:"send_request"})," with some numbers."]}),"\n",(0,r.jsx)(n.li,{children:"We log the response we get back."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," We don't need a ",(0,r.jsx)(n.code,{children:"try/except"})," block with ",(0,r.jsx)(n.code,{children:"rclpy.spin"})," here because our node doesn't need to run forever. It sends one request, gets one response, and then exits."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"registering-and-building",children:"Registering and Building"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Register Node:"})," Add the new client node to your ",(0,r.jsx)(n.code,{children:"setup.py"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"'console_scripts': [\n    'add_two_ints_server = my_first_package.add_two_ints_server:main',\n    'add_two_ints_client = my_first_package.add_two_ints_client:main',\n],\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Build:"})," Run ",(0,r.jsx)(n.code,{children:"colcon build"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Source:"})," ",(0,r.jsx)(n.code,{children:"source install/setup.bash"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Run:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["In one terminal, make sure your server is running:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run my_first_package add_two_ints_server\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["In a second terminal, run your new client:","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ros2 run my_first_package add_two_ints_client\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The client will start, send its request, get the response, print the result, and then exit. You have now built a complete request/response system."}),"\n",(0,r.jsx)(n.p,{children:"In the next lesson, you'll learn how to break free from the built-in message types and create your own."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var t=s(6540);const r={},i=t.createContext(r);function l(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);