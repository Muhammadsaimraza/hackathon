"use strict";(globalThis.webpackChunkrobolearn=globalThis.webpackChunkrobolearn||[]).push([[9109],{8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}},9308:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"module-1-ros/first-code/4-3-writing-subscriber","title":"Lesson 4.3: Writing a Subscriber","description":"A publisher isn\'t very useful on its own. We need another node to receive the messages. In this lesson, you will create a \\"listener\\" node that subscribes to the chatter topic and prints the messages it receives.","source":"@site/docs/module-1-ros/4-first-code/4-3-writing-subscriber.md","sourceDirName":"module-1-ros/4-first-code","slug":"/module-1-ros/first-code/4-3-writing-subscriber","permalink":"/robolearn/docs/module-1-ros/first-code/4-3-writing-subscriber","draft":false,"unlisted":false,"editUrl":"https://github.com/Muhammadsaimraza/robolearn/tree/main/docs/module-1-ros/4-first-code/4-3-writing-subscriber.md","tags":[],"version":"current","frontMatter":{},"sidebar":"textbookSidebar","previous":{"title":"Lesson 4.2: Writing a Publisher","permalink":"/robolearn/docs/module-1-ros/first-code/4-2-writing-publisher"},"next":{"title":"Lesson 4.4: Try With AI","permalink":"/robolearn/docs/module-1-ros/first-code/4-4-try-with-ai"}}');var i=s(4848),t=s(8453);const o={},l="Lesson 4.3: Writing a Subscriber",c={},d=[{value:"The Code",id:"the-code",level:2},{value:"Code Breakdown",id:"code-breakdown",level:3},{value:"Registering the Node",id:"registering-the-node",level:2},{value:"Build and Run",id:"build-and-run",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"lesson-43-writing-a-subscriber",children:"Lesson 4.3: Writing a Subscriber"})}),"\n",(0,i.jsxs)(n.p,{children:['A publisher isn\'t very useful on its own. We need another node to receive the messages. In this lesson, you will create a "listener" node that subscribes to the ',(0,i.jsx)(n.code,{children:"chatter"})," topic and prints the messages it receives."]}),"\n",(0,i.jsx)(n.h2,{id:"the-code",children:"The Code"}),"\n",(0,i.jsxs)(n.p,{children:["Create a new file in your package: ",(0,i.jsx)(n.code,{children:"my_first_package/listener.py"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# my_first_package/my_first_package/listener.py\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass ListenerNode(Node):\n    \"\"\"\n    A ROS 2 node that subscribes to a string message and prints it.\n    \"\"\"\n    def __init__(self):\n        super().__init__('listener_node')\n        self.subscription = self.create_subscription(\n            String,\n            'chatter',\n            self.listener_callback,\n            10)\n        self.get_logger().info('Listener node has been started.')\n\n    def listener_callback(self, msg):\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    \n    listener_node = ListenerNode()\n    \n    try:\n        rclpy.spin(listener_node)\n    except KeyboardInterrupt:\n        pass\n        \n    listener_node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"code-breakdown",children:"Code Breakdown"}),"\n",(0,i.jsx)(n.p,{children:"The structure is very similar to the publisher."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"ListenerNode"})," Class:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"super().__init__('listener_node')"}),": We give the node a unique name."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"self.create_subscription(...)"}),": This is the core of the subscriber.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"String"}),": The type of message to listen for."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"'chatter'"}),": The name of the topic to subscribe to. This ",(0,i.jsx)(n.strong,{children:"must"})," match the topic name used by the publisher."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"self.listener_callback"}),": The name of the function to call whenever a new message is received."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"10"}),": The queue size."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"listener_callback"})," Method:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["This function is the ",(0,i.jsx)(n.strong,{children:"callback"}),". It is executed automatically by ",(0,i.jsx)(n.code,{children:"rclpy"})," every time a message arrives on the ",(0,i.jsx)(n.code,{children:"chatter"})," topic."]}),"\n",(0,i.jsxs)(n.li,{children:["The message itself is passed as the first argument, ",(0,i.jsx)(n.code,{children:"msg"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"self.get_logger().info(...)"}),": We simply log the data field of the received message."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"main"})," Function:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"main"})," function is almost identical to the publisher's. We initialize ",(0,i.jsx)(n.code,{children:"rclpy"}),", create an instance of our node, and then call ",(0,i.jsx)(n.code,{children:"rclpy.spin()"})," to keep it alive and process incoming messages."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"registering-the-node",children:"Registering the Node"}),"\n",(0,i.jsxs)(n.p,{children:["Just like with the publisher, we need to add an entry point for our new node in ",(0,i.jsx)(n.code,{children:"setup.py"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# setup.py\n\n...\nsetup(\n    ...\n    entry_points={\n        'console_scripts': [\n            'talker = my_first_package.talker:main',\n            'listener = my_first_package.listener:main', # Add this line\n        ],\n    },\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"build-and-run",children:"Build and Run"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Build:"})," Go to the root of your workspace (",(0,i.jsx)(n.code,{children:"ros2_ws"}),") and run ",(0,i.jsx)(n.code,{children:"colcon build"})," again. Colcon is smart enough to only rebuild what has changed."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Source:"})," You need to source your workspace again in any new terminals you open. ",(0,i.jsx)(n.code,{children:"source install/setup.bash"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Run:"})," Now you can run both nodes.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In one terminal, run the talker:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run my_first_package talker\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["In a ",(0,i.jsx)(n.strong,{children:"second"})," terminal, run the listener:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run my_first_package listener\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:'You should see the talker publishing its "Hello World" messages, and you will see the listener printing "I heard: ..." for every message it receives.'}),"\n",(0,i.jsx)(n.p,{children:"You have now created a complete, multi-node communication system in ROS 2. You have two independent Python programs communicating with each other using the publish/subscribe pattern, orchestrated by the ROS 2 middleware."}),"\n",(0,i.jsx)(n.p,{children:"In the next lesson, we'll explore how you can use AI to accelerate this development process."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);